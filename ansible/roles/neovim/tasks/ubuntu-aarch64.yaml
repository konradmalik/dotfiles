- name: install compile dependencies for neovim
  become: yes
  apt:
    name:
      - ninja-build
      - gettext
      - libtool
      - libtool-bin
      - autoconf
      - automake
      - cmake
      - g++
      - pkg-config
      - unzip
    state: latest
    update_cache: yes
    autoclean: yes
    autoremove: yes

- name: compile neovim from github (for arm64)
  become: yes
  shell:
    chdir: /tmp
    cmd: |
      git clone --depth 1 --branch v{{ git_versions.nvim }} https://github.com/neovim/neovim
      cd neovim
      make CMAKE_BUILD_TYPE=Release
      make CMAKE_INSTALL_PREFIX=/usr/local install
    creates: /usr/local/bin/nvim

- name: install shfmt binary (arm64)
  become: yes
  shell:
    chdir: /tmp
    cmd: |
      curl -o /usr/local/bin/shfmt -L https://github.com/mvdan/sh/releases/download/v{{ git_versions.shfmt }}/shfmt_v{{ git_versions.shfmt }}_linux_arm64
      chmod +x /usr/local/bin/shfmt
    creates: /usr/local/bin/shfmt
