- name: remove rust because it conflicts with rustup
  become: yes
  community.general.pacman:
    name:
      - rust
    state: absent

- name: install rustup (arch)
  become: yes
  become_user: aur_builder
  kewlfft.aur.aur:
    use: yay
    name:
      - rustup

- name: set default toolchain for aur_builder
  become: yes
  become_user: aur_builder
  args:
    executable: /bin/bash
  environment:
    PATH: "~/.cargo/bin:{{ ansible_env.PATH }}"
  shell:
    cmd: |
      rustup install stable && \
      rustup default stable
