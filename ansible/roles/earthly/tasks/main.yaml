- include: linux.yaml
  when: ansible_system == "Linux"

- include: osx.yaml
  when: ansible_distribution == "MacOSX"

- name: make sure earthly folder exists and has proper mode
  file:
    path: ~/.earthly
    state: directory

- name: link earthly config
  file:
    src: "{{ repo_path }}/files/earthly.yml"
    path: "~/.earthly/config.yml"
    state: link
    force: yes

- name: bootstrap earthly
  become: yes
  shell:
    chdir: /tmp
    cmd: |
      earthly bootstrap --with-autocomplete
    creates: /usr/share/bash-completion/completions/earthly
